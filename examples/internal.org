#+TITLE: Internal API Tests

This document tests internal functions of org-test. These tests verify the correct behavior of the testing framework itself.

* Internal API

** org-test--find-tests

The ~org-test--find-tests~ function finds blocks that match the given test names.

*** Should count tests correctly

This test verifies that ~org-test--find-tests~ finds all blocks matching the test names from expectations.

#+NAME: find-tests-count
#+begin_src emacs-lisp 
(let* ((expect-map (org-test--find-expectations))
       (test-names (hash-table-keys expect-map))
       (tests (org-test--find-tests test-names)))
  (length tests))
#+end_src

#+NAME: expect-find-tests-count-equals
#+begin_example
3
#+end_example

** org-test--find-expectations

The ~org-test--find-expectations~ function finds all expectation blocks and maps them to their corresponding tests.

*** Should count expectation groups correctly

#+NAME: find-expectations-count
#+begin_src emacs-lisp
(let* ((expectations (org-test--find-expectations)))
  (hash-table-count expectations))
#+end_src

#+NAME: expect-find-expectations-count-equals
: 3

*** Should extract correct test names as keys

#+NAME: find-expectations-keys
#+begin_src emacs-lisp
(let ((keys '()))
  (maphash (lambda (key value) (push key keys))
           (org-test--find-expectations))
  (mapconcat #'identity (sort keys #'string<) "\n"))
#+end_src

#+NAME: expect-find-expectations-keys-equals
#+begin_example
find-expectations-count
find-expectations-keys
find-tests-count
#+end_example

