#+TITLE: Internal API Tests

[[file:call_graph.svg]]

This document tests internal functions of org-test. These tests verify the correct behavior of the testing framework itself.

* Internal API

** org-test--find-tests-and-expectations

The ~org-test--find-tests-and-expectations~ function finds both test blocks and expectations in a single pass.

*** Should count tests correctly

This test verifies that the function finds all test blocks that have expectations.

#+NAME: find-tests-count
#+begin_src emacs-lisp 
(let* ((data (org-test--find-tests-and-expectations))
       (test-blocks (car data)))
  (length test-blocks))
#+end_src

#+NAME: expect-find-tests-count-equals
#+begin_example
3
#+end_example

*** Should count expectation groups correctly

This test verifies that the function finds all expectation blocks grouped by test name.

#+NAME: find-expectations-count
#+begin_src emacs-lisp
(let* ((data (org-test--find-tests-and-expectations))
       (expect-map (cdr data)))
  (hash-table-count expect-map))
#+end_src

#+NAME: expect-find-expectations-count-equals
: 3

*** Should extract correct test names as keys

This test verifies that expectation block names are correctly parsed to extract test names.

#+NAME: find-expectations-keys
#+begin_src emacs-lisp
(let* ((data (org-test--find-tests-and-expectations))
       (expect-map (cdr data))
       (keys '()))
  (maphash (lambda (key value) (push key keys)) expect-map)
  (mapconcat #'identity (sort keys #'string<) "\n"))
#+end_src

#+NAME: expect-find-expectations-keys-equals
#+begin_example
find-expectations-count
find-expectations-keys
find-tests-count
#+end_example

